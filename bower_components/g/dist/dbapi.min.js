(function(t,n){var r=/^(=|!=|~|!~|>=|<=|>|<)/,i=t.encodeURIComponent,e=["where","sort","value","fields","column"],s=["limit","offset","format","table","download"];function u(t){var n=this;n.url=t;n.clear()}u.prototype.clear=function(){var t=this;t.attrs={};e.forEach(function(n){t.attrs[n]={}});return this};function o(t,n,r,i){if(r===null){if(n in t)delete t[n]}else if(typeof i!="undefined"&&typeof r=="undefined"){t[n]=i}else{t[n]=r}}function f(t,n,r,i){var e;if(n===null)for(e in t)delete t[e];else if($.isPlainObject(n))for(e in n)o(t,e,n[e],i);else if($.isArray(n))for(var s=0,u=n.length;s<u;s++)o(t,n[s],r,i);else o(t,n,r,i)}function a(t,n,i,e){if($.isPlainObject(n)){for(var s in n){e=n[s];if(e!==null)if(typeof e!="string"||!e.match(r))n[s]="="+e}f(t,n)}else{if(typeof e=="undefined"){e=i;e=typeof e=="string"&&e.match(r)?e:e===null?null:"="+e}else{e=i+e}f(t,n,e)}}function l(t,n,r){var i=t.params(),e={type:n,url:t.url,data:i};if(n=="DELETE"&&i)e.url+="?"+i;return $.ajax(e).done(r)}$.extend(u.prototype,{where:function(t,n,r){a(this.attrs.where,t,n,r);return this},value:function(t,n){a(this.attrs.value,t,n);return this},column:function(t,n){a(this.attrs.column,t,n);return this},sort:function(t,n){f(this.attrs.sort,t,n,true);return this},fields:function(t,n){f(this.attrs.fields,t,n,true);return this},limit:function(t){f(this.attrs,"limit",t);return this},offset:function(t){f(this.attrs,"offset",t);return this},format:function(t){f(this.attrs,"format",t);return this},table:function(t){f(this.attrs,"table",t);return this},download:function(t){f(this.attrs,"download",t);return this},get:function(t){return l(this,"GET",t)},put:function(t){return l(this,"PUT",t)},post:function(t){return l(this,"POST",t)},del:function(t){return l(this,"DELETE",t)}});u.prototype.params=function(){var t=[],n=this;e.forEach(function(r){var e=r.match(/sort|fields/),s=$.map(n.attrs[r],function(t,n){var r=e?t?n:"-"+n:n+t;if(r.match(/[",]/))r='"'+r.replace(/"/g,'""')+'"';return r}).join(",");if(s)t.push(r+"="+i(s))});s.forEach(function(r){if(r in n.attrs)t.push(r+"="+i(n.attrs[r]))});return t.join("&")};u.prototype.toString=function(){var t=this.params();return t?this.url+"?"+t:this.url};if("jQuery"in t)t.jQuery.db=function(t){return new u(t)};else t.db=function(t){return new u(t)}})(this);